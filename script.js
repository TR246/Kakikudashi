window.addEventListener("DOMContentLoaded",()=>{function a(f){function g(n){const o=j[n];if(o.read){if(!o.saidoku)throw new Error(k+", "+JSON.stringify(o));k+=o.saidoku}else o.read=!0,k+=o.readAs||o.character+o.okurigana.split("").map(p=>{const q=p.charCodeAt(0);if(12449>q||12534<q)throw new Error("\u9001\u308A\u4EEE\u540D\u304C\u30AB\u30BF\u30AB\u30CA\u3067\u306F\u3042\u308A\u307E\u305B\u3093");return String.fromCharCode(q-96)}).join("");m[n]!==void 0&&g(m[n])}const h=(n,o,p=0)=>p+n.slice(p).findIndex(o),j=f.map(n=>Object.assign({read:!1},n));let k="";const{length:l}=j,m=Array(length);for(let n=0;n<l;n++){const{character:o,okurigana:p,kaeriten:q,chusen:r,readAs:s,saidoku:t,skip:u}=j[n];if(u){j[n].read=!0;continue}if(r){m[n]=m[n-1],m[n-1]=n;continue}t&&(g(n),j[n].read=!1);const v=q.slice(1)-0;q.includes("re")?m[n+1]=n:["n","k"].includes(q[0])&&2<=v?m[h(j,w=>w.kaeriten===q[0]+(v-1)||2==v&&w.kaeriten===q[0]+"1re",n)]=n:"ge"===q?m[h(j,w=>["jo","jore","chu"].includes(w.kaeriten),n)]=n:"chu"===q?m[h(j,w=>["jo","jore"].includes(w.kaeriten),n)]=n:g(n)}return k}Vue.component("modal-confirm-window",{template:`<transition><div class="modalWindow" v-show="show" @click.self="cancel"><transition><div class="modal-body" v-show="show"><div>{{label}}</div><div class="buttons"><button @click="cancel">キャンセル</button><button @click="close" class="primary">決定</button></div></div></transition></div></transition>`,props:{label:String},data(){return{show:!1}},methods:{open(){return this.show=!0,new Promise((f,g)=>{this.$on("determined",f),this.$on("canceled",g)})},cancel(){this.show=!1,this.$emit("canceled")},close(){this.show=!1,this.$emit("determined")}}}),Vue.component("modal-input-window",{template:`<transition><div class="modalWindow" v-show="show" @click.self="cancel"><transition><div class="modal-body" v-show="show"><label class="block"><div>{{label}}</div><input type="text" class="block" v-model="currentValue" @keyup.enter="close" ref="input"></label><div class="buttons"><button @click="cancel">キャンセル</button><button @click="close" class="primary" :disabled="!currentValue">決定</button></div></div></transition></div></transition>`,props:{label:String,value:String},model:{prop:"value",event:"change"},data(){return{show:!1,currentValue:this.value}},methods:{open(){return this.show=!0,this.currentValue=this.value,requestAnimationFrame(()=>this.$refs.input.focus()),new Promise((f,g)=>{this.$on("change",f),this.$on("canceled",g)})},cancel(){this.show=!1,this.$emit("canceled")},close(){this.show=!1,this.$emit("change",this.currentValue)}}}),Vue.component("modal-panel",{template:`<transition><div class="modalPanel" v-show="show" @click.self="close"><transition><div class="modal-body" v-show="show"><slot></slot></div></transition></div></transition>`,data(){return{show:!1}},methods:{open(){this.show=!0},close(){this.show=!1}}});let b=0;new Vue({el:"main",created(){window.addEventListener("resize",()=>this.windowWidth=window.innerWidth),this.windowWidth=window.innerWidth},data:{windowWidth:0,windowWidthBorder:960,kaeritens:[["re","n1re","jore","k1re"],["n1","n2","n3","n4","n5"],["jo","chu","ge"],["k1","k2","k3","k4"]],kundoku:[],current:0,showDetail:!1,animateDetailKanji:!1},computed:{detailShow(){return this.windowWidthBorder<=this.windowWidth||this.showDetail},currentCharacter(){return this.kundoku[this.current]},result(){let f;try{f=a(this.kundoku)}catch(g){console.log(g),f="\u30A8\u30E9\u30FC: "+g.message}return f}},methods:{openDetail(f){this.current=f,this.showDetail=!0},closeDetail(){this.showDetail=!1},addCharacter(f){this.$refs.addCharacter.open().then(g=>{this.kundoku.splice(f,0,...[...g].map(h=>({id:++b+"",character:h,okurigana:"",kaeriten:"",chusen:!1,readAs:"",saidoku:"",skip:!1})))}).catch(()=>{})},deleteCharacter(f){this.$refs.deleteConfirm.open().then(()=>{this.current=Math.max(0,this.current-1),this.kundoku.splice(f,1)}).catch(()=>{})}}})});